define(["PhysicEngine/Models/Rect","PhysicEngine/Helpers/CollisionHelper"],function(e,t){var n=function(t,n,r,i){this.rect=new e(t,n,r,i),this.objects=[],this.isLeaf=!0,this.minTimeCollision=undefined,this.isUpToDate=!1,this.childs=[]};return n.MAX_OBJECTS_PER_QUAD=10,n.prototype={subdivide:function(){var e=Math.floor(this.rect.size.x/2),r=Math.floor(this.rect.size.y/2),i=this.rect.position.x,s=this.rect.position.y;this.childs.push(new n(i,s,e,r)),this.childs.push(new n(i+e,s,e,r)),this.childs.push(new n(i,s+r,e,r)),this.childs.push(new n(i+e,s+r,e,r));var o=this.objects,u=this.childs,a,f,l=t.checkOverriding;for(var c=0,h=o.length;a=o[c],c<h;c++){var p=a.position,d=a.size;for(var v=0,m=u.length;f=u[v],v<m;v++)l(f.rect.position,f.rect.size,p,d)&&f.insert(a)}this.objects=[],this.isLeaf=!1},insert:function(e){this.isUpToDate=!1;if(this.isLeaf===!0)this.objects.push(e),e.parentQuads.push(this),this.objects.length>n.MAX_OBJECTS_PER_QUAD&&this.subdivide();else{var r=t.checkOverriding,i=this.childs,s,o=e.position,u=e.nextPosition,a=e.size;for(var f=0,l=i.length;s=i[f],f<l;f++)(r(s.rect.position,s.rect.size,o,a)||r(s.rect.position,s.rect.size,u,a))&&s.insert(e)}},remove:function(e){this.isUpToDate=!1;var t=e.parentQuads,n;for(var r=0,i=t.length;n=t[r],r<i;r++){var s=n.objects.indexOf(e);n.objects.splice(s,1)}e.parentQuads=[]},clear:function(){this.isLeaf=!0,this.isUpToDate=!1,this.objects=new Array,this.childs=new Array},update:function(e){this.remove(e),this.insert(e)},getMinTimeCollision:function(){if(this.isUpToDate)return this.minTimeCollision;this.minTimeCollision=undefined;if(this.isLeaf===!0)return this.minTimeCollision=t.getMinTimeCollisionFromObjects(this.objects),this.minTimeCollision;var e=this.childs,n,r;for(var i=0,s=e.length;n=e[i],i<s;i++)r=t.getMinTimeCollision(r,n.getMinTimeCollision());return this.minTimeCollision=r,this.isUpToDate=!0,this.minTimeCollision},getQuadTrees:function(){if(this.isLeaf)return[this];var e=new Array,t=this.childs,n;for(var r=0,i=t.length;n=t[r],r<i;r++)e=e.concat(n.getQuadTrees());return e}},n})