define(["app/ObjectView","app/LevelObject","PhysicEngine/Controller/PhysicController","PhysicEngine/Models/Vector2D","PhysicEngine/Models/ObjectModel","PhysicEngine/Models/QuadTree","PhysicEngine/Events/EventTargetMixin","PhysicEngine/Events/PhysicEvents"],function(e,t,n,r,i,s,o,u){var a=20,f=function(o){var l=this,c=undefined,h=undefined,p=o,d=new n(o),v=[],m=0,g=0;this.pause=!0;var y=function(e){l.dispatchEvent(f.EVENT_COUNT_UPDATE,{collide:m,intersect:g})},b=function(e){m++,y()},w=function(e){g++,y()};this.clearLevel=function(){d.clearObjects(),v=[],m=0,g=0,y()},this.addRandomObjects=function(e){d.clearObjects(),n.GRAVITY=new r(0,0),i.AIR_FRICTION=1,i.CONTACT_FRICTION=new r(1,1),s.MAX_OBJECTS_PER_QUAD=10;for(var t=0;t<e;t++)this.addRandomObject()},this.addRandomObject=function(){var t=new e(p);t.color="#"+(Math.random()*16777215<<0).toString(16);var n=Math.round(Math.random()*(p.canvas.width-a)),s=Math.round(Math.random()*(p.canvas.height-a)),o=a,u=a,f=new i(n,s,o,u),l=new r(Math.random()*10-5,Math.random()*10-5);f.velocity=l,f.collideBits=1,f.mass=1,this.addObject(t,f)},this.testXCollisions=function(){d.clearObjects(),n.GRAVITY=new r(0,0),i.AIR_FRICTION=1,i.CONTACT_FRICTION=new r(1,1),s.MAX_OBJECTS_PER_QUAD=5,this.addCollidingObject(20,20,new r(20,20),new r(4,0),"#FF0000"),this.addCollidingObject(20,20,new r(40,41),new r(6,0),"#FFFF00"),this.addCollidingObject(20,20,new r(220,30),new r(0,0),"#00FF00"),this.addCollidingObject(20,20,new r(320,20),new r(-12,0),"#00FFFF"),this.addCollidingObject(20,20,new r(20,120),new r(0,0),"#000000",Number.MAX_VALUE),this.addCollidingObject(20,20,new r(120,120),new r(4,0),"#FFFF00",2),this.addCollidingObject(20,20,new r(220,120),new r(0,0),"#00FF00"),this.addCollidingObject(20,20,new r(320,120),new r(-4,0),"#00FFFF"),this.addCollidingObject(20,20,new r(420,120),new r(-20,0),"#0000FF",2)},this.testGravity=function(){d.clearObjects(),n.GRAVITY=new r(0,3),i.AIR_FRICTION=.95,s.MAX_OBJECTS_PER_QUAD=5,this.addCollidingObject(800,20,new r(0,300),new r(0,0),"#000000",Number.MAX_VALUE,3),this.addCollidingObject(20,20,new r(40,20),new r(0,0),"#FF0000",1,1),this.addCollidingObject(20,20,new r(40,160),new r(0,-20),"#FFFF00",1,1),this.addCollidingObject(20,20,new r(80,160),new r(20,-20),"#00FF00",1,1)},this.addCollidingObject=function(t,n,r,s,o,u,a){var f=new e(p);f.color=o;var l=new i(r.x,r.y,t,n);return l.velocity=s,l.mass=u||1,l.collideBits=a||1,this.addObject(f,l)},this.addObject=function(e,n){var r=new t(e,n);return n.addEventListener(u.COLLIDE,b),n.addEventListener(u.INTERSECT,w),v.push(r),d.addObject(n),r},this.nextFrame=function(){undefined!==c&&(c--,0==c&&(this.pause=!0,c=undefined,h&&(h(),h=undefined))),d.updatePhysic(),p.clearRect(0,0,p.canvas.width,p.canvas.height),this.drawQuadTrees(),$.each(v,function(){this.updateView()})},this.updateLevel=function(){this.pause||this.nextFrame()},this.playNextFrames=function(e,t){c=e,this.pause=!1,h=t},this.drawQuadTrees=function(){var e=d.getQuadTrees(),t;for(var n=0,r=e.length;t=e[n],n<r;n++)p.strokeStyle="#ff0000",p.strokeRect(t.rect.position.x,t.rect.position.y,t.rect.size.x,t.rect.size.y),0!=t.objects.length&&(p.fillStyle="#ff0000",p.textBaseline="top",p.fillText(t.objects.length,t.rect.position.x+8,t.rect.position.y+8))},this.clearLevel(),setInterval(function(){l.updateLevel()},1e3/30)};return f.EVENT_COUNT_UPDATE="eventCountUpdate",augment(f,o),f})