define(["GameEngine/Events/StateEvents","GameEngine/Factories/ViewFactory","GameEngine/Factories/ModelFactory","GameEngine/States/State","GameEngine/Inputs/KeyboardManager","GameEngine/Commands/Command","GameEngine/Controllers/LevelController","GameEngine/Views/CanvasRenderer","GameEngine/Views/PlayerView","GameEngine/Models/LevelPhysicObject"],function(e,t,n,r,i,s,o,u,a,f){function l(e,i){r.call(this,e,i),this._modelFactory=new n,this._viewFactory=new t,this._canvasRenderer=undefined,this.createView(),this._levelController=new o(e,this._canvasRenderer)}return extend(l,r),l.prototype.start=function(){l.superClass.start.call(this),this._levelController.onInitialize(),this.initializeLevel()},l.prototype.update=function(){l.superClass.update.call(this),this._levelController.onDraw()},l.prototype.escape=function(){this.dispatchEvent(e.SET_NEXT_STATE,{state:"startMenu"})},l.prototype.createView=function(){this._canvasRenderer=new u(this._config.size.width,this._config.size.height),this._view=this._canvasRenderer.getView()},l.prototype.initializeLevel=function(){var e=this._config.levelDef.models;for(var t in e){var n=e[t],r=this._modelFactory.createModel(n);this._levelController.addModel(r)}var i=this._config.levelDef.views;for(var t in i){var n=i[t],s=this._viewFactory.createView(n);this._levelController.addView(s),s.setLevelController&&s.setLevelController(this._levelController)}},l.prototype.initKeyboard=function(){var e=new s(this,"escape");i.addCommand(i.TYPES.keydown,i.KEY_CODES.escape,e)},l})