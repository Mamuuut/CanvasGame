function extend(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.superClass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t)}function augment(e,t){if(arguments[2])for(var n=2,r=arguments.length;n<r;n++)e.prototype[arguments[n]]=t.prototype[arguments[n]];else for(methodName in t.prototype)e.prototype[methodName]||(e.prototype[methodName]=t.prototype[methodName])}var Interface=function(e,t){if(arguments.length!=2)throw new Error("Interface constructor called with "+arguments.length+" arguments, but expected exactly 2.");this.name=e,this.methods=[];for(var n=0,r=t.length;n<r;n++){if(typeof t[n]!="string")throw new Error("Interace constructor expecets method names to be passed in a string.");this.methods.push(t[n])}};Interface.ensureImplements=function(e){if(arguments.length<2)throw new Error("Function Interface.ensureImplements called with"+arguments.length+"arguments, but expected at least 2.");for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t];if(r.constructor!==Interface)throw new Error("Function Interface.ensureImplements expects argumentstwo and above to be Instances of Interface.");for(var i=0,s=r.methods.length;i<s;i++){var o=r.methods[i];if(!e[o]||typeof e[o]!="function")throw new Error("Function Interface.ensureImplements: objectsdoes not implement the "+r.name+" interface. Method "+o+" was not found.")}}},Array.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1}),define("utils",function(){}),requirejs.config({baseUrl:"js/libs",paths:{app:"../app"}}),require(["utils"]),define("../physic-engine",function(){}),define("PhysicEngine/Models/Vector2D",[],function(){var e=function(e,t){this.x=e||0,this.y=t||0};return e.prototype.fromString=function(e){if(null!=string){var t=string.split(";");2==t.length&&(x=parseFloat(t[0]),y=parseFloat(t[1]))}},e.X_AXIS="x",e.Y_AXIS="y",e}),define("PhysicEngine/Models/Rect",["PhysicEngine/Models/Vector2D"],function(e){var t=function(t,n,r,i){this.size=new e(r,i),this.position=new e(t,n)};return t.prototype.getLeftTop=function(e){return this.position[e]},t.prototype.getRightBottom=function(e){return this.position[e]+this.size[e]},t.AXIS_MIN="axis_min",t.AXIS_MAX="axis_max",t}),define("PhysicEngine/Events/PhysicEvents",{COLLIDE:"collide",INTERSECT:"intersect"}),define("PhysicEngine/Models/Collision",["PhysicEngine/Models/Rect","PhysicEngine/Events/PhysicEvents"],function(e,t){var n=function(n,r,i,s){function o(){var t=n.getContactObjects(i,e.AXIS_MIN),s=r.getContactObjects(i,e.AXIS_MAX);return t.concat(s)}function u(){return Math.round(f()/a())}function a(){var e=0,t=o(),n;for(var r=0,i=t.length;n=t[r],r<i;r++){if(n.hasMaxMass())return 1;e+=n.mass}return e}function f(){var e=0,t=o(),n;for(var r=0,s=t.length;n=t[r],r<s;r++){if(n.hasMaxMass())return n.velocity[i];e+=n.mass*n.velocity[i]}return e}var s=s,i=i,n=n,r=r;this.Collide=function(){var e=u(),a=o(),f;for(var l=0,c=a.length;f=a[l],l<c;l++)f.updateTimePosition(s),f.velocity[i]=e,f.updateTimeNextPosition(s);n.dispatchEvent(t.COLLIDE,r),r.dispatchEvent(t.COLLIDE,n)},this.getTime=function(){return s},this.getObjects=function(){return o()}};return n}),define("PhysicEngine/Helpers/CollisionHelper",["PhysicEngine/Models/Vector2D","PhysicEngine/Models/Rect","PhysicEngine/Models/Collision"],function(e,t,n){var r={checkOverriding:function(e,t,n,r){return!(n.x>=e.x+t.x||n.x+r.x<=e.x||n.y>=e.y+t.y||n.y+r.y<=e.y)},checkContacts:function(t,n){if(t.hasMaxMass()&&n.hasMaxMass())return;if(n.position.x>t.position.x+t.size.x||n.position.x+n.size.x<t.position.x||n.position.y>t.position.y+t.size.y||n.position.y+n.size.y<t.position.y)return;var i=r.getAxisProj(e.X_AXIS,t,n),s=r.getAxisProj(e.Y_AXIS,t,n);i<s?r.checkAxisContact(e.X_AXIS,t,n):r.checkAxisContact(e.Y_AXIS,t,n)},getCollision:function(t,i){if(t.hasMaxMass()&&i.hasMaxMass())return null;var s=r.getLeftTopObject(e.X_AXIS,t,i),o=r.getRightBottomObject(e.X_AXIS,t,i),u=r.getCollisionTime(e.X_AXIS,s,o),a=r.getLeftTopObject(e.Y_AXIS,t,i),f=r.getRightBottomObject(e.Y_AXIS,t,i),l=r.getCollisionTime(e.Y_AXIS,a,f);if(0<=u&&1>=u&&0<=l&&1>=l)return u<=l?new n(s,o,e.X_AXIS,u):new n(a,f,e.Y_AXIS,l);if(0<=u&&1>=u){var c=a.getTimePosition(u).y+a.size.y,h=f.getTimePosition(u).y;if(c>=h&&s.velocity.x>o.velocity.x)return new n(s,o,e.X_AXIS,u)}else if(0<=l&&1>=l){var p=s.getTimePosition(l).x+s.size.x,d=o.getTimePosition(l).x;if(p>=d&&a.velocity.y>f.velocity.y)return new n(a,f,e.Y_AXIS,l)}return null},getCollisionTime:function(e,t,n){return(t.position[e]+t.size[e]-n.position[e])/(n.velocity[e]-t.velocity[e])},getMinTimeCollisionFromObjects:function(e){var t=undefined;for(var n=0;n<e.length;n++)for(var i=n+1;i<e.length;i++)e[n].collidesWith(e[i])&&(r.checkContacts(e[n],e[i]),t=r.getMinTimeCollision(t,r.getCollision(e[n],e[i])));return t},getMinTimeCollision:function(e,t){var n=r.isValidCollision(e),i=r.isValidCollision(t);if(!n&&i)return t;if(n&&!i)return e;if(n&&i)return e.getTime()<t.getTime()?e:t},isValidCollision:function(e){return undefined!=e&&e.getTime()>=0&&e.getTime()<=1},checkAxisContact:function(e,n,i){var s=r.getLeftTopObject(e,n,i),o=r.getRightBottomObject(e,n,i);s.velocity[e]>=o.velocity[e]&&(s.contacts.addContact(o,e,t.AXIS_MAX),o.contacts.addContact(s,e,t.AXIS_MIN))},getAxisProj:function(e,t,n){var r=Math.max(t.getLeftTop(e),n.getLeftTop(e)),i=Math.min(t.getRightBottom(e),n.getRightBottom(e));return i-r},getLeftTopObject:function(e,t,n){return t.getRightBottom(e)<=n.getLeftTop(e)?t:n},getRightBottomObject:function(e,t,n){return t.getRightBottom(e)<=n.getLeftTop(e)?n:t}};return r}),define("PhysicEngine/Models/QuadTree",["PhysicEngine/Models/Rect","PhysicEngine/Helpers/CollisionHelper"],function(e,t){var n=function(t,n,r,i){this.rect=new e(t,n,r,i),this.objects=[],this.isLeaf=!0,this.minTimeCollision=undefined,this.isUpToDate=!1,this.childs=[]};return n.MAX_OBJECTS_PER_QUAD=10,n.prototype={subdivide:function(){var e=Math.floor(this.rect.size.x/2),r=Math.floor(this.rect.size.y/2),i=this.rect.position.x,s=this.rect.position.y;this.childs.push(new n(i,s,e,r)),this.childs.push(new n(i+e,s,e,r)),this.childs.push(new n(i,s+r,e,r)),this.childs.push(new n(i+e,s+r,e,r));var o=this.objects,u=this.childs,a,f,l=t.checkOverriding;for(var c=0,h=o.length;a=o[c],c<h;c++){var p=a.position,d=a.size;for(var v=0,m=u.length;f=u[v],v<m;v++)l(f.rect.position,f.rect.size,p,d)&&f.insert(a)}this.objects=[],this.isLeaf=!1},insert:function(e){this.isUpToDate=!1;if(this.isLeaf===!0)this.objects.push(e),e.parentQuads.push(this),this.objects.length>n.MAX_OBJECTS_PER_QUAD&&this.subdivide();else{var r=t.checkOverriding,i=this.childs,s,o=e.position,u=e.nextPosition,a=e.size;for(var f=0,l=i.length;s=i[f],f<l;f++)(r(s.rect.position,s.rect.size,o,a)||r(s.rect.position,s.rect.size,u,a))&&s.insert(e)}},remove:function(e){this.isUpToDate=!1;var t=e.parentQuads,n;for(var r=0,i=t.length;n=t[r],r<i;r++){var s=n.objects.indexOf(e);n.objects.splice(s,1)}e.parentQuads=[]},clear:function(){this.isLeaf=!0,this.isUpToDate=!1,this.objects=new Array,this.childs=new Array},update:function(e){this.remove(e),this.insert(e)},getMinTimeCollision:function(){if(this.isUpToDate)return this.minTimeCollision;this.minTimeCollision=undefined;if(this.isLeaf===!0)return this.minTimeCollision=t.getMinTimeCollisionFromObjects(this.objects),this.minTimeCollision;var e=this.childs,n,r;for(var i=0,s=e.length;n=e[i],i<s;i++)r=t.getMinTimeCollision(r,n.getMinTimeCollision());return this.minTimeCollision=r,this.isUpToDate=!0,this.minTimeCollision},getQuadTrees:function(){if(this.isLeaf)return[this];var e=new Array,t=this.childs,n;for(var r=0,i=t.length;n=t[r],r<i;r++)e=e.concat(n.getQuadTrees());return e}},n}),define("PhysicEngine/Controller/PhysicController",["PhysicEngine/Models/Vector2D","PhysicEngine/Models/QuadTree"],function(e,t){var n=function(r,i){function s(){o();var e=l.getMinTimeCollision();if(null!=e){u++,e.Collide();var t=e.getObjects(),n;for(var r=0,i=t.length;n=t[r],r<i;r++)l.update(n);s()}}function o(){var e;for(var t=0,n=a.length;e=a[t],t<n;t++)e.clearContacts()}var u,a=new Array,f=r,l=new t(0,0,f.canvas.width,f.canvas.height);this.addObject=function(e){a.push(e),l.insert(e)},this.removeObject=function(e){var t=a.indexOf(e);a.splice(t,1),l.remove(e)},this.clearObjects=function(){l.clear(),a=new Array},this.updatePhysic=function(){u=0,l.clear();var e;for(var t=0,n=a.length;e=a[t],t<n;t++)e.updateForces(),e.resetForces(),e.updateTimeNextPosition(0),e.parentQuads=new Array,l.insert(e);s();var e,r;for(var t=0,n=a.length;e=a[t],t<n;t++)e.updatePosition(),e.checkObjectIntersections(a)},this.getQuadTrees=function(){return l.getQuadTrees()},this.clearObjects(),n.GRAVITY=null!=i?i:new e(0,3)};return n.GRAVITY=new e,n}),define("PhysicEngine/Models/AxisContacts",[],function(){return AxisContacts=function(){this.axis_min=new Array,this.axis_max=new Array},AxisContacts.prototype.addContact=function(e,t){this[t].push(e)},AxisContacts}),define("PhysicEngine/Models/Contacts",["PhysicEngine/Models/AxisContacts"],function(e){var t=function(){this.x=null,this.y=null,this.clear()};return t.prototype.addContact=function(e,t,n){return this.getObjects(t,n).push(e)},t.prototype.hasContact=function(e){return 0!=this[e].axis_min.length||0!=this[e].axis_max.length},t.prototype.getObjects=function(e,t){return this.getAxisContacts(e)[t]},t.prototype.getAxisContacts=function(e){return this[e]},t.prototype.clear=function(){this.x=new e,this.y=new e},t}),define("PhysicEngine/Events/EventManager",[],function(){function e(){if(t!==null)throw new Error("Cannot instantiate more than one EventManager, use EventManager.getInstance()");this.initialize()}var t=null;return e.prototype={initialize:function(){this._eventListener={}},dispatchEvent:function(e,t,n){var r=this._eventListener[t];if(r){var i={type:t,data:n};for(var s in r){var o=r[s];o.object===e&&o.listener(i)}}},getEventListener:function(e,t,n){var r=this._eventListener[t];if(r)for(var i in r){var s=r[i];if(s.object===e&&s.listener==n)return n}},addEventListener:function(e,t,n){this.getEventListener(e,t,n)||(this._eventListener[t]=this._eventListener[t]||[],this._eventListener[t].push({object:e,listener:n}))},removeEventListener:function(e,t,n){var n=this.getEventListener(e,t,n);if(n){var r=this._eventListener[t].indexOf(n);this._eventListener[t].splice(r,1)}}},e.getInstance=function(){return t===null&&(t=new e),t},e.getInstance()}),define("PhysicEngine/Events/EventTargetMixin",["PhysicEngine/Events/EventManager"],function(e){function t(){}return t.prototype={dispatchEvent:function(t,n){e.dispatchEvent(this,t,n)},addEventListener:function(t,n){e.addEventListener(this,t,n)},removeEventListener:function(t,n){e.removeEventListener(this,t,n)}},t}),define("PhysicEngine/Models/ObjectModel",["PhysicEngine/Models/Vector2D","PhysicEngine/Models/Rect","PhysicEngine/Models/Contacts","PhysicEngine/Events/EventTargetMixin","PhysicEngine/Events/PhysicEvents","PhysicEngine/Helpers/CollisionHelper","PhysicEngine/Controller/PhysicController"],function(e,t,n,r,i,s,o){var u=function(r,i,s,a){function f(e){e.x=Math.max(-u.MAX_VELOCITY.x,Math.min(u.MAX_VELOCITY.x,e.x)),e.y=Math.max(-u.MAX_VELOCITY.y,Math.min(u.MAX_VELOCITY.y,e.y))}function l(e){return-1!=h.objectFriction?h.objectFriction:h.contacts.hasContact(e)?u.CONTACT_FRICTION[e]:u.AIR_FRICTION}t.call(this,r,i,s,a);var c=null,h=this;this.nextPosition=new e(r,i),this.velocity=new e,this.mass=1,this.contacts=new n,this.objectFriction=-1,this.collideBits=0,this.parentQuads=[],this.updateTimePosition=function(e){f(this.velocity),this.position=this.getTimePosition(e)},this.updateTimeNextPosition=function(e){f(this.velocity),this.nextPosition=this.getTimePosition(1-e)},this.updateForces=function(){if(!this.hasMaxMass()){var t,n=this.velocity;for(var r=0,i=c.length;t=c[r],r<i;r++)n.x+=t.x,n.y+=t.y;n.x*=l(e.Y_AXIS),n.y*=l(e.X_AXIS)}},this.resetForces=function(){c=new Array,this.addForce(o.GRAVITY)},this.addForce=function(e){c.push(e)},this.resetForces()};return extend(u,t),u.MAX_VELOCITY=new e(40,40),u.CONTACT_FRICTION=new e(.5,.9),u.AIR_FRICTION=.95,u.prototype.updatePosition=function(){this.position.x=this.nextPosition.x,this.position.y=this.nextPosition.y},u.prototype.checkObjectIntersections=function(e){var t,n=s.checkOverriding,r=this.position,o=this.size;for(var u=0,a=e.length;t=e[u],u<a;u++)this!=t&&n(r,o,t.position,t.size)&&this.dispatchEvent(i.INTERSECT,{object:t})},u.prototype.collidesWith=function(e){var t=this.collideBits&e.collideBits;return 0!=t},u.prototype.clearContacts=function(){this.contacts.clear()},u.prototype.getContactObjects=function(e,t){var n=new Array;n.push(this);var r=this.contacts.getObjects(e,t);if(0!=r.length){var i;for(var s=0,o=r.length;i=r[s],s<o;s++)n=n.concat(i.getContactObjects(e,t))}return n},u.prototype.getTimePosition=function(t){return new e(Math.round(this.position.x+t*this.velocity.x),Math.round(this.position.y+t*this.velocity.y))},u.prototype.hasMaxMass=function(){return Number.MAX_VALUE==this.mass},augment(u,r),u}),define("physic-engine",function(){}),requirejs.config({baseUrl:"js/libs",paths:{app:"../app"}}),require(["physic-engine"]),define("../game-engine",function(){}),define("GameEngine/Events/StateEvents",{SET_NEXT_STATE:"setNextState"}),define("GameEngine/States/StateManager",["GameEngine/Events/StateEvents"],function(e){function t(){this._currentState=undefined,this._states={}}return t.prototype.addState=function(t,n){this._states[t]=n;var r=this;n.addEventListener(e.SET_NEXT_STATE,function(e){r.setCurrentState(e.data.state)})},t.prototype.setCurrentState=function(e){this._currentState&&this._currentState.stop();if(!this._states[e])throw new Error("setCurrentState called with unknown state name "+e);this._currentState=this._states[e],this._currentState.start()},t.prototype.update=function(){this._currentState.update()},t}),define("GameEngine/Helpers/ImageLoader",[],function(){function t(){if(e!==null)throw new Error("Cannot instantiate more than one ImageLoader, use ImageLoader.getInstance()");this.initialize()}var e=null;return t.prototype={initialize:function(){this._images={},this._nbLoadingImages=0,this._onImagesLoaded=undefined},loadImage:function(e,t){var n=new Image,r=this;n.onload=function(){r._images[e]=n,r._nbLoadingImages--,0==r._nbLoadingImages&&"function"==typeof r._onImagesLoaded&&r._onImagesLoaded()},n.src=t},loadImages:function(e,t){this._onImagesLoaded=t;for(index in e){var n=e[index];this.loadImage(n.key,n.src),this._nbLoadingImages++}},getImage:function(e){return this._images[e]}},t.getInstance=function(){return e===null&&(e=new t),e},t.getInstance()}),define("GameEngine/Inputs/KeyboardManager",[],function(){function t(){if(e!==null)throw new Error("Cannot instantiate more than one KeyboardManager, use KeyboardManager.getInstance()");this.initialize()}var e=null;return t.prototype={initialize:function(){this._keydown={},this._keyup={},this._keyCommands=[],this.KEY_CODES={enter:13,escape:27,left:37,up:38,right:39},this.TYPES={keydown:0,keydownRepeat:1,keyup:2};var e=this;$(document).keydown(function(t){var n=t.which;e._keydown[n]||(e._keydown[n]=0)}),$(document).keyup(function(t){var n=t.which;e._keyup[n]=!0,delete e._keydown[n]})},addCommand:function(e,t,n){var r={type:e,key:t,command:n};this._keyCommands.push(r)},clearCommands:function(){this._keyCommands=[]},update:function(){var e;for(e in this._keydown)this._keydown[e]++;for(e in this._keyCommands){var t=this._keyCommands[e];t&&this.checkCommand(t)&&t.command.execute()}this._keyup=[]},checkCommand:function(e){var t=e.key;switch(e.type){case this.TYPES.keydown:return 1==this._keydown[t];case this.TYPES.keydownRepeat:return null!=this._keydown[t];case this.TYPES.keyup:return 1==this._keyup[t];default:return!1}return!1}},t.getInstance=function(){return e===null&&(e=new t),e},t.getInstance()}),define("GameEngine/States/State",["PhysicEngine/Events/EventTargetMixin","GameEngine/Inputs/KeyboardManager"],function(e,t){function n(e,t){this._config=e,this._container=t,this._view=undefined,this.createView()}return n.prototype.start=function(){this._container.append(this._view),this.initKeyboard()},n.prototype.update=function(){t.update()},n.prototype.stop=function(){this._view.detach(),t.clearCommands()},n.prototype.createView=function(){},n.prototype.initKeyboard=function(){},augment(n,e),n}),define("GameEngine/States/LoadingState",["GameEngine/Helpers/ImageLoader","GameEngine/States/State","GameEngine/Events/StateEvents"],function(e,t,n){function r(e,n){t.call(this,e,n),this._timeoutComplete=!1,this._imagesLoaded=!1}return extend(r,t),r.prototype.start=function(){r.superClass.start.call(this);var t=this;setTimeout(function(){t._timeoutComplete=!0},this._config.loadingState.duration),e.loadImages(this._config.levelImg,function(){t._imagesLoaded=!0})},r.prototype.update=function(){this._timeoutComplete&&this._imagesLoaded&&this.dispatchEvent(n.SET_NEXT_STATE,{state:"startMenu"})},r.prototype.createView=function(){var e=new Image;e.src=this._config.loadingState.src,e.width=$(this._container).width();var t=$('<div class="loading-view"></div>');t.append(e),this._view=t},r}),define("GameEngine/Commands/Command",[],function(){function e(e,t){this._receiver=e,this._action=t}return e.prototype.execute=function(){this._receiver[this._action]()},e}),define("GameEngine/States/StartMenuState",["GameEngine/Inputs/KeyboardManager","GameEngine/States/State","GameEngine/Commands/Command","GameEngine/Events/StateEvents"],function(e,t,n,r){function i(e,n){t.call(this,e,n)}return extend(i,t),i.prototype.start=function(){i.superClass.start.call(this)},i.prototype.startGame=function(){this.dispatchEvent(r.SET_NEXT_STATE,{state:"game"})},i.prototype.createView=function(){var e=$('<div class="button">Start</div>'),t=this;e.click(function(){t.startGame()});var n=$('<div class="start-menu-view"></div>').append(e);this._view=n},i.prototype.initKeyboard=function(){var t=new n(this,"startGame");e.addCommand(e.TYPES.keydown,e.KEY_CODES.enter,t)},i}),define("GameEngine/Models/LevelObjectMixin",[],function(){return LevelObjectMixin=function(){},LevelObjectMixin.prototype={supportPhysic:!1,getX:function(){return this.position.x},getY:function(){return this.position.y},setX:function(e){this.position.x=e},setY:function(e){this.position.y=e},getWidth:function(){return this.size.x},getHeight:function(){return this.size.y},getXScale:function(){return this._xScale||1},setXScale:function(e){this._xScale=e}},LevelObjectMixin}),define("GameEngine/Models/LevelObject",["PhysicEngine/Models/Rect","GameEngine/Models/LevelObjectMixin"],function(e,t){function n(t,n,r,i){e.call(this,t,n,r,i)}return extend(n,e),augment(n,t),n}),define("GameEngine/Models/LevelPhysicObject",["PhysicEngine/Models/Vector2D","PhysicEngine/Models/ObjectModel","PhysicEngine/Events/PhysicEvents","GameEngine/Models/LevelObjectMixin"],function(e,t,n,r){function i(e,r,i,s){t.call(this,e,r,i,s);var o=new Array,u=this,a=function(e){var t;for(var n=0,r=o.length;t=o[n],n<r;n++)t.acceptsObject(u,e.data.object)&&t.execute(u,e.data.object)};this.preyBits=0,this.predatorBits=0,this.isAlive=!0,this.addAction=function(e){o.push(e)},this.supportPhysic=!0,this.addEventListener(n.INTERSECT,a)}return extend(i,t),augment(i,r),i}),define("GameEngine/Events/ObjectEvents",{DYING:"dying",GAME_OVER:"gameOver"}),define("GameEngine/Actions/KillAction",["GameEngine/Events/ObjectEvents"],function(e){var t=function(){};return t.prototype.acceptsObject=function(e,t){return e.isAlive&&0!=(e.predatorBits&t.preyBits)},t.prototype.execute=function(t,n){n.dispatchEvent(e.DYING)},t}),define("GameEngine/Models/KillerObject",["GameEngine/Models/LevelPhysicObject","GameEngine/Actions/KillAction"],function(e,t){function n(n,r,i,s){e.call(this,n,r,i,s),this.predatorBits=1,this.addAction(new t)}return extend(n,e),n}),define("GameEngine/Factories/ModelFactory",["GameEngine/Models/LevelObject","GameEngine/Models/LevelPhysicObject","GameEngine/Models/KillerObject"],function(e,t,n){return ModelFactory=function(){},ModelFactory.prototype.createModel=function(r){switch(r.modelClass){case"LevelObject":var i=new e(r.x,r.y,r.width,r.height);return i;case"LevelPhysicObject":var i=new t(r.x,r.y,r.width,r.height);return i.mass=r.mass,i.collideBits=r.collideBits,i;case"KillerObject":var i=new n(r.x,r.y,r.width,r.height);return i.mass=r.mass,i.collideBits=r.collideBits,i;default:throw new Error("Model class "+r.modelClass+" is not supported.")}},ModelFactory}),define("GameEngine/Views/Sprite",[],function(){function e(e,t){this._spriteIdx=0,this._img=e,this._model=t,this.getSpriteIdx=function(){return this._spriteIdx},this.setSpriteIdx=function(e){this._spriteIdx=e},this.getModel=function(){return this._model}}return e.prototype.add=function(e){},e.prototype.remove=function(e){},e.prototype.getChild=function(e){},e.prototype.getZIndex=function(){return 0},e.prototype.onDraw=function(e){e.drawTexture(this._img,this._model.getX(),this._model.getY(),this._model.getWidth(),this._model.getXScale(),this._spriteIdx)},e}),define("GameEngine/Views/FrameAnimation",["GameEngine/Helpers/ImageLoader","GameEngine/Views/Sprite"],function(e,t){function n(n,r){this._nbFrames=0,this._currentFrames=0,n.img=e.getImage(n.src),t.call(this,n.img,r),this.updateTextureIndex=function(){this._currentFrames++;if(this._currentFrames>=n.frameDuration){var e=this.getSpriteIdx();e=(e+1)%this._nbFrames,this._currentFrames=0,this.setSpriteIdx(e)}},this._nbFrames=n.img.width/n.width}return extend(n,t),n.prototype.onDraw=function(e){this.updateTextureIndex(),n.superClass.onDraw.call(this,e)},n}),define("GameEngine/Views/PlayerView",["PhysicEngine/Models/Vector2D","GameEngine/Inputs/KeyboardManager","GameEngine/Commands/Command","GameEngine/Views/FrameAnimation","GameEngine/Events/ObjectEvents"],function(e,t,n,r,i){function s(e,t){r.call(this,e,t),this.initCommands(e);var n=function(e){console.log("ARGHHHHH!"),t.isAlive=!1};t.addEventListener(i.DYING,n),t.preyBits=1}return extend(s,r),s.prototype.moveRight=function(){this._model.addForce(new e(2,0))},s.prototype.moveLeft=function(){this._model.addForce(new e(-2,0))},s.prototype.jump=function(){this._model.addForce(new e(0,-30))},s.prototype.initCommands=function(e){for(var r in e.commands){var i=e.commands[r];t.addCommand(i.keyType,i.keyCode,new n(this,i.action))}},s}),define("GameEngine/Views/ColorRect",[],function(){function e(e,t){this._color=e.color,this._model=t,this.getModel=function(){return this._model}}return e.prototype.add=function(e){},e.prototype.remove=function(e){},e.prototype.getChild=function(e){},e.prototype.getZIndex=function(){return 0},e.prototype.onDraw=function(e){e.fillRect(this._model.position.x,this._model.position.y,this._model.size.x,this._model.size.y,this._color)},e}),define("GameEngine/Views/RandomSprite",["GameEngine/Helpers/ImageLoader","GameEngine/Views/Sprite"],function(e,t){function n(n,r){n.img=e.getImage(n.src);var i=n.img.width/n.width;t.call(this,n.img,r);var s=Math.floor(Math.random()*i);this.setSpriteIdx(s)}return extend(n,t),n}),define("GameEngine/Views/LevelGroupView",[],function(){function e(){this._children=[]}return e.prototype.setLevelController=function(e){this._levelController=e},e.prototype.add=function(e){this._children.push(e),this._children.sort(function(e,t){return e.getZIndex()<t.getZIndex()})},e.prototype.remove=function(e){for(var t=0,n=this._children.length;t<n;t++)if(this._children[t]===e){this._children.splice(t,1);break}},e.prototype.getChild=function(e){return this._children[e]},e.prototype.getChildren=function(){return this._children},e.prototype.onDraw=function(e){for(var t=0,n=this._children.length;t<n;t++)this._children[t].onDraw(e)},e.prototype.getZIndex=function(){return 0},e}),define("GameEngine/Views/ScrollView",["GameEngine/Factories/ViewFactory","GameEngine/Helpers/ImageLoader","GameEngine/Views/Sprite","GameEngine/Views/LevelGroupView","GameEngine/Models/LevelObject"],function(e,t,n,r,i){function s(e,t){r.call(this),this._viewFactory=t,this._def=e,this._width=e.screenWidth,this._minDelay=e.viewDef.width/e.speed,this._delay=0,this._sequenceIdx=0}return extend(s,r),s.prototype.isViewOut=function(e){var t=e.getModel();return t.getX()+t.getWidth()<0},s.prototype.addView=function(e){if(0==this._delay){this._def.viewDef.x=this._width;var t=this._viewFactory.createView(this._def.viewDef);t.getModel().velocity.x=-this._def.speed,this._levelController._physicController.addObject(t.getModel()),this.add(t);var n=this._minDelay;this._def.maxDelay?n=Math.floor(Math.random()*this._def.maxDelay):this._def.sequence&&(n=this._def.sequence[this._sequenceIdx],this._sequenceIdx=(this._sequenceIdx+1)%this._def.sequence.length),this._delay=this._minDelay+n}else this._delay--},s.prototype.removeView=function(e){this.remove(e)},s.prototype.onDraw=function(e){this.addView(this._width);for(var t in this.getChildren()){var n=this.getChild(t);this.isViewOut(n)&&this.removeView(n)}s.superClass.onDraw.call(this,e)},s}),define("GameEngine/Factories/ViewFactory",["GameEngine/Factories/ModelFactory","GameEngine/Helpers/ImageLoader","GameEngine/Views/PlayerView","GameEngine/Views/ColorRect","GameEngine/Views/Sprite","GameEngine/Views/RandomSprite","GameEngine/Views/FrameAnimation","GameEngine/Views/ScrollView"],function(e,t,n,r,i,s,o,u){return ViewFactory=function(){this._modelFactory=new e},ViewFactory.prototype.createView=function(e){switch(e.viewClass){case"PlayerView":var a=this._modelFactory.createModel(e);return new n(e,a);case"ColorRect":var a=this._modelFactory.createModel(e);return new r(e,a);case"Sprite":var a=this._modelFactory.createModel(e);return new i(t.getImage(e.src),a);case"RandomSprite":var a=this._modelFactory.createModel(e);return new s(e,a);case"FrameAnimation":var a=this._modelFactory.createModel(e);return new o(e,a);case"ScrollView":return new u(e,this);default:throw new Error("View class "+e.viewClass+" is not supported.")}},ViewFactory}),define("GameEngine/Controllers/LevelController",["PhysicEngine/Models/Vector2D","PhysicEngine/Controller/PhysicController","GameEngine/Views/LevelGroupView","GameEngine/Models/LevelPhysicObject"],function(e,t,n,r){return LevelController=function(e,t){this._levelView=undefined,this._scrollController=undefined,this._physicController=undefined,this._canvas=t,this._gameConfig=e},LevelController.prototype.onInitialize=function(){this._levelView=new n,this._physicController=new t(this._canvas.getContext(),new e(-0.5,3))},LevelController.prototype.addModel=function(e){e.supportPhysic&&this._physicController.addObject(e)},LevelController.prototype.addView=function(e){e.getModel&&e.getModel().supportPhysic&&this._physicController.addObject(e.getModel()),this._levelView.add(e)},LevelController.prototype.onDraw=function(){this._canvas.clear(),this._physicController.updatePhysic(),this._levelView.onDraw(this._canvas)},LevelController}),define("GameEngine/Views/CanvasRenderer",[],function(){function e(e,t){this._container=$('<div id="canvas_container"></div>'),this._canvas=$('<canvas id="game_canvas" width="'+e+'" height="'+t+'"></canvas>'),this._children=[],this._container.append(this._canvas),this._ctx=this._canvas[0].getContext("2d")}return e.prototype.getContext=function(){return this._ctx},e.prototype.getView=function(){return this._canvas},e.prototype.clear=function(){this._ctx.clearRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)},e.prototype.drawTexture=function(e,t,n,r,i,s){var o=r?r*s:0,u=0,a=r||e.width,f=e.height,l=-a/2,c=-f/2;this._ctx.translate(t-l,n-c),this._ctx.scale(i,1),this._ctx.drawImage(e,o,u,a,f,l,c,a,f),this._ctx.scale(1/i,1),this._ctx.translate(-t+l,-n+c)},e.prototype.fillRect=function(e,t,n,r,i){this._ctx.fillStyle=i,this._ctx.fillRect(e,t,n,r)},e.prototype.fillBottomRect=function(e,t,n){this._ctx.fillStyle=n,this._ctx.fillRect(0,this._ctx.canvas.height-e-t,this._ctx.canvas.width,e)},e}),define("GameEngine/States/GameState",["GameEngine/Events/StateEvents","GameEngine/Factories/ViewFactory","GameEngine/Factories/ModelFactory","GameEngine/States/State","GameEngine/Inputs/KeyboardManager","GameEngine/Commands/Command","GameEngine/Controllers/LevelController","GameEngine/Views/CanvasRenderer","GameEngine/Views/PlayerView","GameEngine/Models/LevelPhysicObject"],function(e,t,n,r,i,s,o,u,a,f){function l(e,i){r.call(this,e,i),this._modelFactory=new n,this._viewFactory=new t,this._canvasRenderer=undefined,this.createView(),this._levelController=new o(e,this._canvasRenderer)}return extend(l,r),l.prototype.start=function(){l.superClass.start.call(this),this._levelController.onInitialize(),this.initializeLevel()},l.prototype.update=function(){l.superClass.update.call(this),this._levelController.onDraw()},l.prototype.escape=function(){this.dispatchEvent(e.SET_NEXT_STATE,{state:"startMenu"})},l.prototype.createView=function(){this._canvasRenderer=new u(this._config.size.width,this._config.size.height),this._view=this._canvasRenderer.getView()},l.prototype.initializeLevel=function(){var e=this._config.levelDef.models;for(var t in e){var n=e[t],r=this._modelFactory.createModel(n);this._levelController.addModel(r)}var i=this._config.levelDef.views;for(var t in i){var n=i[t],s=this._viewFactory.createView(n);this._levelController.addView(s),s.setLevelController&&s.setLevelController(this._levelController)}},l.prototype.initKeyboard=function(){var e=new s(this,"escape");i.addCommand(i.TYPES.keydown,i.KEY_CODES.escape,e)},l}),define("GameEngine/GameEngine",["GameEngine/States/StateManager","GameEngine/States/LoadingState","GameEngine/States/StartMenuState","GameEngine/States/GameState"],function(e,t,n,r){function i(i,s){this._stateManager=new e;var o=new t(s,i),u=new n(s,i),a=new r(s,i);this._stateManager.addState("loading",o),this._stateManager.addState("startMenu",u),this._stateManager.addState("game",a),this._stateManager.setCurrentState("loading");var f=this._stateManager;setInterval(function(){f.update()},s.frameRate)}return i})